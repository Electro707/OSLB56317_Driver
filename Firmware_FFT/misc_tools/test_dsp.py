import matplotlib.pyplot as plt
import numpy as np
import scipy.fft as fft

fft_size = 512
fs = 48000

fc = 1000
fc2 = 500

x = np.arange(0, fft_size/fs, (1/fs))
# y = np.sin(fc*2*np.pi * x)
y = [0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396,-25540,-27246,-28486,-29238,-29491,-29238,-28486,-27246,-25540,-23396,-20853,-17953,-14745,-11285,-7632,-3849,0,3849,7632,11285,14745,17953,20853,23396,25540,27246,28486,29238,29491,29238,28486,27246,25540,23396,20853,17953,14745,11285,7632,3849,0,-3849,-7632,-11285,-14745,-17953,-20853,-23396]

window = [    0,     1,     4,     11,    19,    30,    44,    60,    79,    100,   123,
    149,   178,   208,   242,   277,   316,   356,   399,   445,   492,   543,
    595,   650,   708,   767,   830,   894,   961,   1030,  1102,  1175,  1251,
    1330,  1410,  1493,  1579,  1666,  1756,  1847,  1941,  2038,  2136,  2237,
    2339,  2444,  2551,  2660,  2771,  2884,  2999,  3117,  3236,  3357,  3480,
    3605,  3732,  3861,  3992,  4125,  4259,  4396,  4534,  4674,  4816,  4959,
    5105,  5252,  5400,  5551,  5703,  5856,  6011,  6168,  6326,  6486,  6647,
    6810,  6974,  7140,  7307,  7475,  7645,  7816,  7989,  8162,  8337,  8513,
    8690,  8869,  9048,  9229,  9411,  9594,  9778,  9962,  10148, 10335, 10523,
    10711, 10901, 11091, 11282, 11474, 11666, 11860, 12054, 12248, 12443, 12639,
    12836, 13033, 13230, 13428, 13626, 13825, 14024, 14224, 14424, 14624, 14824,
    15025, 15226, 15427, 15628, 15829, 16030, 16232, 16433, 16635, 16836, 17038,
    17239, 17440, 17641, 17842, 18042, 18242, 18442, 18642, 18841, 19040, 19239,
    19437, 19635, 19832, 20029, 20225, 20420, 20615, 20810, 21003, 21196, 21388,
    21580, 21770, 21960, 22149, 22337, 22525, 22711, 22896, 23080, 23264, 23446,
    23627, 23807, 23986, 24164, 24341, 24517, 24691, 24864, 25035, 25206, 25375,
    25543, 25709, 25874, 26037, 26199, 26360, 26519, 26677, 26832, 26987, 27140,
    27291, 27440, 27588, 27734, 27879, 28021, 28162, 28301, 28439, 28574, 28708,
    28839, 28969, 29097, 29223, 29348, 29470, 29590, 29708, 29824, 29939, 30051,
    30161, 30269, 30375, 30478, 30580, 30679, 30777, 30872, 30965, 31056, 31144,
    31230, 31314, 31396, 31476, 31553, 31628, 31700, 31771, 31839, 31904, 31968,
    32029, 32087, 32144, 32197, 32249, 32298, 32344, 32389, 32430, 32470, 32507,
    32541, 32573, 32603, 32630, 32655, 32677, 32697, 32714, 32729, 32741, 32751,
    32759, 32764, 32766, 32766, 32764, 32759, 32751, 32741, 32729, 32714, 32697,
    32677, 32655, 32630, 32603, 32573, 32541, 32507, 32470, 32430, 32389, 32344,
    32298, 32249, 32197, 32144, 32087, 32029, 31968, 31904, 31839, 31771, 31700,
    31628, 31553, 31476, 31396, 31314, 31230, 31144, 31056, 30965, 30872, 30777,
    30679, 30580, 30478, 30375, 30269, 30161, 30051, 29939, 29824, 29708, 29590,
    29470, 29348, 29223, 29097, 28969, 28839, 28708, 28574, 28439, 28301, 28162,
    28021, 27879, 27734, 27588, 27440, 27291, 27140, 26987, 26832, 26677, 26519,
    26360, 26199, 26037, 25874, 25709, 25543, 25375, 25206, 25035, 24864, 24691,
    24517, 24341, 24164, 23986, 23807, 23627, 23446, 23264, 23080, 22896, 22711,
    22525, 22337, 22149, 21960, 21770, 21580, 21388, 21196, 21003, 20810, 20615,
    20420, 20225, 20029, 19832, 19635, 19437, 19239, 19040, 18841, 18642, 18442,
    18242, 18042, 17842, 17641, 17440, 17239, 17038, 16836, 16635, 16433, 16232,
    16030, 15829, 15628, 15427, 15226, 15025, 14824, 14624, 14424, 14224, 14024,
    13825, 13626, 13428, 13230, 13033, 12836, 12639, 12443, 12248, 12054, 11860,
    11666, 11474, 11282, 11091, 10901, 10711, 10523, 10335, 10148, 9962,  9778,
    9594,  9411,  9229,  9048,  8869,  8690,  8513,  8337,  8162,  7989,  7816,
    7645,  7475,  7307,  7140,  6974,  6810,  6647,  6486,  6326,  6168,  6011,
    5856,  5703,  5551,  5400,  5252,  5105,  4959,  4816,  4674,  4534,  4396,
    4259,  4125,  3992,  3861,  3732,  3605,  3480,  3357,  3236,  3117,  2999,
    2884,  2771,  2660,  2551,  2444,  2339,  2237,  2136,  2038,  1941,  1847,
    1756,  1666,  1579,  1493,  1410,  1330,  1251,  1175,  1102,  1030,  961,
    894,   830,   767,   708,   650,   595,   543,   492,   445,   399,   356,
    316,   277,   242,   208,   178,   149,   123,   100,   79,    60,    44,
    30,    19,    11,    4,     1,     0,]

mcu_res = [8,8,8,9,10,16,23,45,113,608,4756,5926,1692,164,48,19,10,4,1,1,1,1,2,2,2,2,3,2,3,3,4,3,1,2,2,2,1,1,1,2,2,2,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,3,3,2,2,3,2,2,0,1,0,0,1,1,2,1,2,0,2,1,1,3,0,1,0,0,1,1,1,2,1,0,0,1,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,2,2,2,2,3,2,2,4,2,1,2,1,2,2,2,2,2,1,1,2,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,0,1,1,1,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,2,0,2,0,1,1,1,1,1,0,1,1,1,1,1,1,2,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,0,0,0,0,1,0,1,1,0,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,0,1,0,0,0,1,1,1,0,1,0,0,1,1,1,0,1,0,0,1,2,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,0,1,1,1,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,1,1,1,1,3,4,6,10,20,49,167,1695,5921,4759,604,111,39,19,9,7,3,2,1,]
# y /= 2
# y += 0.5
# y *= 0.9

# y *= 2**15
# y = y.astype(int)
# toPrint = f'q15_t testSine[{fft_size}] = {{'
# for i in y:
#     toPrint += f"{i},"
# toPrint = toPrint[:-1] + '};'
# print(toPrint)

# plt.plot(x, y)
# plt.show()

y = np.array(y, dtype=float)
y *= np.array(window, dtype=float)
y /= 2**15

y_fft = fft.fft(y, n=fft_size)

# print(np.array(mcu_res) / y_fft.real)
print((np.abs((y_fft/fft_size).real)).astype(int))

x = x[1:(fft_size//2)]
y_fft = y_fft[1:(fft_size//2)]

plt.plot(x, (y_fft.real*y_fft.real) / 2**16)
plt.plot(x, (y_fft.imag*y_fft.imag) / 2**16)
plt.show()

y2 = (y_fft.imag*y_fft.imag) + (y_fft.real*y_fft.real)
y2 /= 2**16
plt.plot(x, y2)
plt.show()